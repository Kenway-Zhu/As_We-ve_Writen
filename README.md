# 如我们所书 (As We've Written)

一个基于 Flask 和 FAISS 的对话系统，支持智能对话、记忆检索和自动归档。

## 核心功能

### 💬 智能对话
- 流式输出，实时显示AI回复
- 思考模式：显示"思考中..."提示
- 记忆检索：自动从向量库检索相关记忆，增强对话上下文
- 回复完成后显示时间戳

### 📚 记忆管理
- 对话归档：自动总结对话内容并存入向量库
- 智能过滤：自动拒绝不当内容（政治敏感、色情、违法等）
- 记忆检索：每次对话自动检索top5相关记忆

### 👥 多用户支持
- 会话隔离：每个用户独立的对话历史和状态
- 自动恢复：刷新页面后自动恢复会话状态

### 💾 自动备份
- 每3小时自动备份向量库
- 自动清理超过5天的旧备份

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 初始化数据库

```bash
python init_db.py
```

### 3. 启动服务

```bash
python app.py
```

### 4. 访问应用

打开浏览器访问：`http://localhost:8093`

## 项目结构

```
.
├── app.py              # Flask后端主文件
├── config.py           # 配置文件
├── vector_store.py     # FAISS向量库管理
├── backup_manager.py   # 自动备份管理
├── init_db.py          # 数据库初始化脚本
├── templates/          # 前端模板
├── static/             # 静态资源
└── backups/            # 备份文件目录（自动创建）
```

## 配置说明

编辑 `config.py` 配置：
- **智谱AI配置**：API Key、模型名称等
- **Embedding模型**：向量化模型路径
- **FAISS配置**：向量索引文件路径
- **其他配置**：端口、调试模式等

## 主要特性

- ✅ 流式对话输出
- ✅ AI思考模式提示
- ✅ 向量库记忆检索
- ✅ 对话自动归档
- ✅ 多用户会话管理
- ✅ 自动备份与清理
- ✅ 智能内容过滤

## 注意事项

- 首次使用需要初始化向量数据库
- 向量库文件保存在项目目录：`vector_index.faiss` 和 `vector_metadata.pkl`
- 备份文件保存在 `backups/` 目录
- 生产环境请设置环境变量 `SECRET_KEY`
